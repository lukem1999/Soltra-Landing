<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Soltra Pricing</title>
<link rel="stylesheet" href="styles.css" />
</head>

<body class="pricing-page">
  <header class="pricing-header">
    <h1>Simple, Transparent Pricing</h1>
    <p>Start for free — scale when you're ready.</p>
    <a href="index.html" class="back-link">← Back to home</a>
  </header>

  <section class="pricing-plans">
    <!-- FREE -->
    <div class="plan-card">
      <h2>Free</h2>
      <p class="price">$0 / month</p>
      <ul>
        <li>Up to <strong>5 contractors</strong></li>
        <li>Up to <strong>10 payouts / month</strong></li>
        <li>Base &amp; Polygon only</li>
        <li>Basic support</li>
      </ul>
      <a href="app.html" class="plan-btn">Get Started</a>
    </div>

    <!-- PRO -->
    <div class="plan-card highlight">
      <h2>Pro</h2>
      <p class="price">$29 / month</p>
      <ul>
        <li><strong>Unlimited contractors</strong></li>
        <li><strong>Unlimited payouts</strong></li>
        <li>All chains supported</li>
        <li>Priority email support</li>
      </ul>

      <!-- IMPORTANT: id + data-price-id -->
      <button
        id="btn-pro-checkout"
        class="plan-btn gold"
        data-price-id="price_1SjurWH8mH6Wr4HGWUeyezdC"
        type="button"
      >
        Upgrade
      </button>
    </div>

    <!-- ORG -->
    <div class="plan-card">
      <h2>Organization</h2>
      <p class="price">$59 / month</p>
      <ul>
        <li>Everything in Pro +</li>
        <li>Team accounts (coming soon)</li>
        <li>Onboarding assistance</li>
        <li>Quarterly check-ins</li>
      </ul>
      <button id="btn-org-checkout" class="plan-btn" type="button">
        Contact Sales
      </button>
    </div>
  </section>

  <script>
  const SUPABASE_FUNCTION_URL =
    'https://lvuvkgnkhrzpwlssupyh.functions.supabase.co/create-checkout-session';

  document.addEventListener('DOMContentLoaded', () => {
    const proBtn = document.getElementById('btn-pro-checkout');
    if (!proBtn) return;

    proBtn.addEventListener('click', async () => {
      const priceId = proBtn.dataset.priceId; // from data-price-id attribute
      if (!priceId) {
        console.error('No data-price-id set on Pro button');
        alert('Price not configured on this plan.');
        return;
      }

      proBtn.disabled = true;
      proBtn.textContent = 'Redirecting…';

      try {
        const res = await fetch(SUPABASE_FUNCTION_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ priceId }),
        });

        if (!res.ok) {
          const bodyText = await res.text().catch(() => '');
          console.error('Checkout HTTP error:', res.status, bodyText);
          alert('Something went wrong starting checkout. Check console for details.');
          return;
        }

        const data = await res.json().catch((err) => {
          console.error('Failed to parse JSON from checkout function:', err);
          throw err;
        });

        console.log('Checkout response:', data);

        if (!data || !data.url) {
          console.error('No URL returned from checkout function', data);
          alert('No checkout URL returned. Check console for details.');
          return;
        }

        window.location.href = data.url;
      } catch (err) {
        console.error('Error starting checkout:', err);
        alert('Something went wrong starting checkout. Check console for details.');
      } finally {
        proBtn.disabled = false;
        proBtn.textContent = 'Upgrade';
      }
    });
  });
</script>
</body>
</html>

