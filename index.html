<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soltra ‚Äî Stablecoin Contractor Payouts</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="auth-wrapper">
  <div class="auth-card">
    <h2>Sign in to Soltra</h2>
    <p class="auth-subtitle">Use your email to manage your contractor payouts.</p>

    <form id="auth-form">
      <input type="email" name="email" placeholder="you@company.com" required>
      <input type="password" name="password" placeholder="Password" required>
      <button type="submit" class="btn auth-btn">Sign in</button>
    </form>

    <button id="auth-toggle-mode" class="auth-toggle">
      New here? Create an account
    </button>

    <p id="auth-message" class="auth-message"></p>
    <button id="signout-btn" class="mini-btn" style="display:none;">Sign out</button>

  </div>
</div>

  <header class="navbar">
  <div class="logo">
    <span class="soltra-s">S</span>
  </div>
  <span class="brand-text">Soltra</span>
</header>


  <main>
   <!-- HERO / LANDING SECTION -->
<section class="hero-section">
  <div class="shell hero-row">

    <!-- LEFT: copy + waitlist -->
    <div class="hero-copy">
      <!-- Waitlist form -->
      <form id="waitlist-form" class="waitlist-form">
        <input
          type="email"
          name="email"
          class="waitlist-input"
          placeholder="you@dao.xyz"
          required
        />
        <button type="submit" class="btn waitlist-btn">
          Join the waitlist
        </button>
        <div id="waitlist-message" class="waitlist-message"></div>
      </form>

      <!-- Eyebrow label -->
      <div class="hero-eyebrow">Stablecoin payouts for global teams</div>

      <!-- Main headline -->
      <h1 class="hero-title">
        Global stablecoin payouts.<br />
        <span class="highlight">Clean records.</span> No<br />
        spreadsheets.
      </h1>

      <!-- Subcopy -->
      <p class="hero-sub">
        Pay contractors in USDC and keep organized, auditable records built
        for Web3 teams and DAOs.
      </p>

      <p class="hero-sub" style="font-size: 0.8rem; margin-top: 0.3rem;">
        <span style="color: var(--gold); font-weight: 600;">Early access.</span>
        No KYC required to join. Built for DAOs, Web3 teams, and crypto-native orgs.
      </p>
    </div>

    <!-- RIGHT: payouts preview card -->
    <div class="hero-preview">
      <div class="hero-preview-inner">
        <h3>Payouts ‚Äî September &nbsp;¬∑&nbsp; USDC ¬∑ Base</h3>

        <div class="payout-row">
          <span>0xA3‚Ä¶7F91</span>
          <span>1,200 USDC</span>
        </div>
        <div class="payout-row">
          <span>0x93‚Ä¶C218</span>
          <span>850 USDC</span>
        </div>
        <div class="payout-row">
          <span>0x12‚Ä¶A841</span>
          <span>1,700 USDC</span>
        </div>

        <div class="payout-summary">
          <div>
            <div class="payout-summary-main">$3,750</div>
            <div class="payout-summary-label">Total this month</div>
          </div>
          <div style="text-align: right;">
            <div class="payout-summary-main">9</div>
            <div class="payout-summary-label">Contractors</div>
          </div>
        </div>

        <div class="payout-summary" style="margin-top: 0.4rem;">
          <div class="payout-summary-label">
            CSV export ready ¬∑ Clean audit trail
          </div>
        </div>
      </div>
    </div>

  </div>
</section>


    <section class="app-shell">
  <div class="app-layout">
    <!-- Sidebar -->
    <aside class="app-sidebar">
      <div class="sidebar-logo">
        <div class="sidebar-mark">S</div>
        <span>Soltra</span>
      </div>

      <nav class="app-tabs">
        <button class="tab-button active" data-target="dashboard">Overview</button>
        <button class="tab-button" data-target="contractors">Contractors</button>
        <button class="tab-button" data-target="payouts">Payouts</button>
        <button class="tab-button" data-target="reports">Reports</button>
      </nav>

      <div class="sidebar-foot">
        <span class="sidebar-label">Environment</span>
        <span class="sidebar-pill">Sandbox</span>
      </div>
    </aside>

    <!-- Main content -->
    <div class="app-main">
      <header class="app-header">
        <div>
          <h2>Soltra Dashboard</h2>
          <p>Track stablecoin payouts, contractors, and reporting in one place.</p>
        </div>
        <div class="app-header-controls">
          <select class="app-select">
            <option>This month</option>
            <option>Last month</option>
            <option>Last 90 days</option>
          </select>
          <div class="user-pill">
            <span class="user-avatar">L</span>
            <span class="user-name">You</span>
          </div>
        </div>
      </header>

      <div class="app-main-inner">
        <div id="view-dashboard" class="app-view">
  <div class="shell dashboard-shell">

    <!-- Top bar: title + filters -->
    <div class="dash-header">
      <div>
        <h2 class="dash-title">Dashboard</h2>
        <p class="dash-subtitle">
          Overview of your USDC payouts and contractors across chains.
        </p>
      </div>

      <div class="dash-filters">
        <div class="dash-filter-group">
          <label for="dash-range">Range</label>
          <select id="dash-range">
            <option value="7d">Last 7 days</option>
            <option value="30d" selected>Last 30 days</option>
            <option value="90d">Last 90 days</option>
            <option value="all">All time</option>
          </select>
        </div>

        <div class="dash-filter-group">
          <label for="dash-chain">Chain</label>
          <select id="dash-chain">
            <option value="all" selected>All chains</option>
            <option value="BASE">Base</option>
            <option value="POLYGON">Polygon</option>
            <option value="ETHEREUM">Ethereum</option>
          </select>
        </div>
      </div>
    </div>

    <!-- KPI cards -->
    <div class="dash-kpi-row">
      <div class="dash-card">
        <div class="dash-card-label">Total payouts</div>
        <div id="dash-total-30d" class="dash-card-value">$0</div>
        <div id="dash-payout-count" class="dash-card-sub">0 payouts</div>
      </div>

      <div class="dash-card">
        <div class="dash-card-label">Active contractors</div>
        <div id="dash-contractors" class="dash-card-value">0</div>
        <div class="dash-card-sub">With payouts in this range</div>
      </div>

      <div class="dash-card">
        <div class="dash-card-label">Chains used</div>
        <div id="dash-chains" class="dash-card-value">0</div>
        <div id="dash-chain-list" class="dash-card-sub">No activity yet.</div>
      </div>
    </div>

    <!-- Recent payouts table -->
    <div class="dash-card dash-table-card">
      <div class="dash-card-header">
        <div>
          <div class="dash-card-label">Recent payouts</div>
          <div class="dash-card-sub">
            Latest on-chain payouts matching your filters.
          </div>
        </div>
      </div>

      <div class="dash-table-wrapper">
        <table class="dash-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Contractor</th>
              <th>Amount</th>
              <th>Chain</th>
              <th>Tx hash</th>
            </tr>
          </thead>
          <tbody id="dash-payouts-table">
            <tr>
              <td colspan="5">Loading payouts‚Ä¶</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>


            <div class="card card-side">
              <h3 class="card-title">This month snapshot</h3>
              <ul class="summary-list">
                <li>
                  <span>Total contractors paid</span>
                  <strong>6</strong>
                </li>
                <li>
                  <span>Average payout size</span>
                  <strong>$625</strong>
                </li>
                <li>
                  <span>CSV exports</span>
                  <strong>2</strong>
                </li>
                <li>
                  <span>Failed payouts</span>
                  <strong>0</strong>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- ================= CONTRACTORS VIEW ================= -->
        <div class="app-view hidden" id="view-contractors">
          <div class="list-header">
            <h3>Contractors</h3>
          </div>

          <!-- Add contractor form -->
          <form class="add-contractor-form" id="add-contractor-form">
            <input type="text" name="name" placeholder="Name" required>
            <input type="text" name="wallet_address" placeholder="Wallet address (0x...)" required>
            <input type="text" name="role" placeholder="Role (e.g. DevOps)">
            <input type="text" name="country" placeholder="Country (e.g. US)">
            <button type="submit" class="mini-btn">+ Add contractor</button>
          </form>

          <table class="app-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Wallet</th>
                <th>Role</th>
                <th>Country</th>
                <th>Last paid</th>
              </tr>
            </thead>
            <tbody id="contractors-body">
              <!-- Filled dynamically from Supabase -->
            </tbody>
          </table>
        </div>

        <!-- ================= PAYOUTS VIEW ================= -->
        <div class="app-view hidden" id="view-payouts">
          <h3>Log new payout</h3>

          <form class="payout-form" id="payout-form">
            <label>
              Contractor
              <select name="contractor_id" id="payout-contractor" required>
                <option value="">Select contractor</option>
                <!-- options filled from contractors table -->
              </select>
            </label>

            <label>
              Amount (USDC)
              <input type="number" name="amount" step="0.01" placeholder="1200" required>
            </label>

            <label>
              Chain
              <select name="chain" required>
                <option value="base">Base</option>
                <option value="polygon">Polygon</option>
              </select>
            </label>

            <label>
              Transaction hash
              <input type="text" name="tx_hash" placeholder="0x..." required>
            </label>

            <label>
              Date
              <input type="date" name="tx_date">
            </label>

            <label>
              Notes (optional)
              <textarea name="note" rows="2" placeholder="Weekly contributor payout"></textarea>
            </label>

            <button type="submit" class="btn full-width">Save payout</button>
          </form>

          <h3 class="table-title">Recent payouts</h3>
          <table class="app-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Contractor</th>
                <th>Amount</th>
                <th>Chain</th>
                <th>Hash</th>
              </tr>
            </thead>
            <tbody id="payouts-body">
              <!-- filled dynamically -->
            </tbody>
          </table>
        </div>

        <!-- ================= REPORTS VIEW ================= -->
        <div class="app-view hidden" id="view-reports">
          <div class="list-header">
            <h3>Reports</h3>
            <button class="mini-btn">Export CSV</button>
          </div>

          <div class="filters-row">
            <select>
              <option>September 2025</option>
              <option>August 2025</option>
            </select>
            <select>
              <option>All contractors</option>
              <option>Anna L</option>
              <option>Marcus V</option>
            </select>
            <select>
              <option>All chains</option>
              <option>Base</option>
              <option>Polygon</option>
            </select>
          </div>

          <table class="app-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Contractor</th>
                <th>Amount</th>
                <th>USD value</th>
                <th>Hash</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Sep 12</td>
                <td>Anna L</td>
                <td>1,200 USDC</td>
                <td>$1,200</td>
                <td>0x9F1C‚Ä¶72a3</td>
              </tr>
              <tr>
                <td>Sep 10</td>
                <td>Marcus V</td>
                <td>850 USDC</td>
                <td>$850</td>
                <td>0xA8B7‚Ä¶19f0</td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</section>

    
<div class="section-divider"></div>




    <section class="features" id="features">
  <div class="feature">
    <div class="feature-icon">üìä</div>
    <h3>Payout Logs</h3>
    <p>Track USDC transactions with TX hashes and timestamps, all in one place.</p>
  </div>

  <div class="feature">
    <div class="feature-icon">üìÅ</div>
    <h3>Reports</h3>
    <p>Instant CSV/PDF exports for accountants or audits, ready whenever you need them.</p>
  </div>

  <div class="feature">
    <div class="feature-icon">üîí</div>
    <h3>Non-Custodial</h3>
    <p>We never touch funds ‚Äî Soltra keeps your records clean, not your money.</p>
  </div>
</section>

  </main>

  <footer>
    <p>¬© <span id="year"></span> Soltra Labs Inc ¬∑ Built for the future of finance</p>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

 <!-- Supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  // === Supabase config (DEV ONLY) ===
  const SUPABASE_URL = 'https://lvuvkgnkhrzpwlssupyh.supabase.co';
  const SUPABASE_ANON_KEY =
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx2dXZrZ25raHJ6cHdsc3N1cHloIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNDkyOTIsImV4cCI6MjA3ODkyNTI5Mn0.9C1-3Di7tXJCgb_7ZHj7mz6QL5fDMvnvmBziYqgGeDs';

  // Supabase client (for auth + REST)
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // === GLOBAL STATE ===
  let contractorsCache = [];
  let authMode = 'signin';       // 'signin' | 'signup'
  let filterRange = '30d';       // '7d' | '30d' | '90d' | 'all'
  let filterChain = 'all';       // 'all' | 'BASE' | 'POLYGON' | 'ETHEREUM'

  // === UTILITIES ===
  function formatUSD(amount) {
    if (!amount || isNaN(amount)) return '$0';
    return `$${amount.toLocaleString('en-US', {
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    })}`;
  }

  function setAuthMessage(text, type = '') {
    const el = document.getElementById('auth-message');
    if (!el) return;
    el.textContent = text || '';
    el.className = 'auth-message';
    if (type) el.classList.add(type);
  }

  function setAuthMode(mode) {
    authMode = mode;
    const toggle = document.getElementById('auth-toggle-mode');
    const btn = document.querySelector('#auth-form .auth-btn');
    if (!toggle || !btn) return;

    if (mode === 'signin') {
      btn.textContent = 'Sign in';
      toggle.textContent = 'New here? Create an account';
    } else {
      btn.textContent = 'Create account';
      toggle.textContent = 'Already have an account? Sign in';
    }
    setAuthMessage('');
  }

  // === TAB NAVIGATION ===
  function initTabs() {
    const tabButtons = document.querySelectorAll('.tab-button');
    const views = {
      dashboard: document.getElementById('view-dashboard'),
      contractors: document.getElementById('view-contractors'),
      payouts: document.getElementById('view-payouts'),
      reports: document.getElementById('view-reports'),
    };

    if (!tabButtons.length) return;

    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        tabButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const target = btn.dataset.target;
        Object.entries(views).forEach(([key, el]) => {
          if (!el) return;
          if (key === target) el.classList.remove('hidden');
          else el.classList.add('hidden');
        });
      });
    });
  }

  // === CONTRACTORS ===
  async function loadContractors() {
    const tbody = document.getElementById('contractors-body');
    if (tbody) {
      tbody.innerHTML = '<tr><td colspan="5">Loading contractors...</td></tr>';
    }

    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/contractors?select=*`, {
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
        },
      });

      if (!res.ok) {
        if (tbody) {
          tbody.innerHTML =
            `<tr><td colspan="5">Error loading data (${res.status})</td></tr>`;
        }
        return;
      }

      const data = await res.json();
      contractorsCache = data;

      if (tbody) {
        if (!data.length) {
          tbody.innerHTML = '<tr><td colspan="5">No contractors yet.</td></tr>';
        } else {
          tbody.innerHTML = '';
          data.forEach(c => {
            const tr = document.createElement('tr');
            const lastPaid = c.last_paid_at
              ? new Date(c.last_paid_at).toLocaleDateString()
              : '‚Äî';
            tr.innerHTML = `
              <td>${c.name || ''}</td>
              <td>${c.wallet_address || ''}</td>
              <td>${c.role || ''}</td>
              <td>${c.country || ''}</td>
              <td>${lastPaid}</td>
            `;
            tbody.appendChild(tr);
          });
        }
      }

      populateContractorSelect();
    } catch (err) {
      console.error(err);
      if (tbody) {
        tbody.innerHTML =
          '<tr><td colspan="5">Error loading contractors.</td></tr>';
      }
    }
  }

  function populateContractorSelect() {
    const select = document.getElementById('payout-contractor');
    if (!select) return;

    select.innerHTML = '<option value="">Select contractor</option>';

    contractorsCache.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c.id;
      opt.textContent = c.name || c.wallet_address;
      select.appendChild(opt);
    });
  }

  async function addContractor(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    const name = formData.get('name')?.trim();
    const wallet = formData.get('wallet_address')?.trim();
    const role = formData.get('role')?.trim();
    const country = formData.get('country')?.trim();

    if (!name || !wallet) {
      alert('Name and wallet address are required.');
      return;
    }

    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/contractors`, {
        method: 'POST',
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json',
          Prefer: 'return=representation',
        },
        body: JSON.stringify({ name, wallet_address: wallet, role, country }),
      });

      if (!res.ok) {
        console.error('Error inserting contractor', await res.text());
        alert('Error adding contractor.');
        return;
      }

      form.reset();
      await loadContractors();
    } catch (err) {
      console.error(err);
      alert('Network error adding contractor.');
    }
  }

  // === PAYOUTS ===
  async function loadPayouts() {
    const tbody = document.getElementById('payouts-body');
    if (!tbody) return;

    tbody.innerHTML = '<tr><td colspan="5">Loading payouts...</td></tr>';

    // date filter
    let sinceISO = null;
    if (filterRange !== 'all') {
      const since = new Date();
      if (filterRange === '7d') since.setDate(since.getDate() - 7);
      else if (filterRange === '30d') since.setDate(since.getDate() - 30);
      else if (filterRange === '90d') since.setDate(since.getDate() - 90);
      sinceISO = since.toISOString();
    }

    const params = [
      'select=*,contractors(name)',
      'order=tx_timestamp.desc',
      'limit=50',
    ];

    if (sinceISO) {
      params.push(`tx_timestamp=gte.${encodeURIComponent(sinceISO)}`);
    }
    if (filterChain !== 'all') {
      params.push(`chain=eq.${encodeURIComponent(filterChain)}`);
    }

    const url = `${SUPABASE_URL}/rest/v1/payouts?` + params.join('&');

    try {
      const res = await fetch(url, {
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
        },
      });

      if (!res.ok) {
        tbody.innerHTML =
          `<tr><td colspan="5">Error loading payouts (${res.status})</td></tr>`;
        return;
      }

      const data = await res.json();

      if (!data.length) {
        tbody.innerHTML =
          '<tr><td colspan="5">No payouts for this range.</td></tr>';
        return;
      }

      tbody.innerHTML = '';
      data.forEach(p => {
        const tr = document.createElement('tr');

        const date = p.tx_timestamp
          ? new Date(p.tx_timestamp).toLocaleDateString()
          : '‚Äî';

        const name = p.contractors?.name || 'Unknown';

        tr.innerHTML = `
          <td>${date}</td>
          <td>${name}</td>
          <td>${p.amount} ${p.asset_symbol || 'USDC'}</td>
          <td>${(p.chain || '').toUpperCase()}</td>
          <td>${p.tx_hash}</td>
        `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error(err);
      tbody.innerHTML =
        '<tr><td colspan="5">Error loading payouts.</td></tr>';
    }
  }

  async function addPayout(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    const contractor_id = formData.get('contractor_id');
    const amountStr = formData.get('amount');
    const chain = formData.get('chain');
    const tx_hash = formData.get('tx_hash')?.trim();
    const tx_date = formData.get('tx_date');
    const note = formData.get('note')?.trim();

    if (!contractor_id || !amountStr || !chain || !tx_hash) {
      alert('Contractor, amount, chain, and tx hash are required.');
      return;
    }

    const amount = Number(amountStr);
    if (!amount || amount <= 0) {
      alert('Amount must be a positive number.');
      return;
    }

    const tx_timestamp = tx_date
      ? new Date(tx_date).toISOString()
      : new Date().toISOString();

    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/payouts`, {
        method: 'POST',
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json',
          Prefer: 'return=representation',
        },
        body: JSON.stringify({
          contractor_id,
          amount,
          asset_symbol: 'USDC',
          chain,
          tx_hash,
          tx_timestamp,
          note,
        }),
      });

      if (!res.ok) {
        console.error('Error inserting payout', await res.text());
        alert('Error saving payout.');
        return;
      }

      form.reset();
      await loadPayouts();
      await loadDashboard();
    } catch (err) {
      console.error(err);
      alert('Network error saving payout.');
    }
  }

  // === DASHBOARD ===
  async function loadDashboard() {
    const totalEl = document.getElementById('dash-total-30d');
    const payoutCountEl = document.getElementById('dash-payout-count');
    const contractorsEl = document.getElementById('dash-contractors');
    const chainsEl = document.getElementById('dash-chains');
    const chainListEl = document.getElementById('dash-chain-list');
    const tableBody = document.getElementById('dash-payouts-table');

    if (!totalEl || !tableBody) return;

    // date filter
    let sinceISO = null;
    if (filterRange !== 'all') {
      const since = new Date();
      if (filterRange === '7d') since.setDate(since.getDate() - 7);
      else if (filterRange === '30d') since.setDate(since.getDate() - 30);
      else if (filterRange === '90d') since.setDate(since.getDate() - 90);
      sinceISO = since.toISOString();
    }

    const params = [
      'select=*,contractors(name)',
      'order=tx_timestamp.desc',
      'limit=200',
    ];

    if (sinceISO) {
      params.push(`tx_timestamp=gte.${encodeURIComponent(sinceISO)}`);
    }
    if (filterChain !== 'all') {
      params.push(`chain=eq.${encodeURIComponent(filterChain)}`);
    }

    const url = `${SUPABASE_URL}/rest/v1/payouts?` + params.join('&');

    try {
      const res = await fetch(url, {
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
        },
      });

      if (!res.ok) {
        console.error('Dashboard fetch error', res.status, await res.text());
        totalEl.textContent = '$0';
        payoutCountEl.textContent = 'Error loading payouts';
        return;
      }

      const data = await res.json();

      const totalAmount = data.reduce(
        (sum, p) => sum + (Number(p.amount) || 0),
        0
      );
      const payoutCount = data.length;

      const contractorIds = new Set(
        data.map(p => p.contractor_id).filter(Boolean)
      );
      const chains = new Set(
        data.map(p => (p.chain || '').toUpperCase()).filter(Boolean)
      );

      totalEl.textContent = formatUSD(totalAmount);
      payoutCountEl.textContent =
        payoutCount === 1 ? '1 payout' : `${payoutCount} payouts`;

      if (contractorsEl) contractorsEl.textContent = contractorIds.size;
      if (chainsEl) chainsEl.textContent = chains.size || 0;
      if (chainListEl) {
        chainListEl.textContent = chains.size
          ? Array.from(chains).join(' ¬∑ ')
          : 'No payouts for this range.';
      }

      tableBody.innerHTML = '';

      if (!data.length) {
        tableBody.innerHTML =
          '<tr><td colspan="5">No payouts for this range.</td></tr>';
        return;
      }

      data.slice(0, 10).forEach(p => {
        const tr = document.createElement('tr');

        const date = p.tx_timestamp
          ? new Date(p.tx_timestamp).toLocaleDateString()
          : '‚Äî';

        const name = p.contractors?.name || 'Unknown';

        tr.innerHTML = `
          <td>${date}</td>
          <td>${name}</td>
          <td>${p.amount} ${p.asset_symbol || 'USDC'}</td>
          <td>${(p.chain || '').toUpperCase()}</td>
          <td>${p.tx_hash}</td>
        `;
        tableBody.appendChild(tr);
      });
    } catch (err) {
      console.error('Dashboard error', err);
      totalEl.textContent = '$0';
      payoutCountEl.textContent = 'Error loading data';
      tableBody.innerHTML =
        '<tr><td colspan="5">Error loading payouts.</td></tr>';
    }
  }

  // === WAITLIST ===
  async function handleWaitlistSubmit(e) {
    e.preventDefault();
    const form = e.target;
    const msgEl = document.getElementById('waitlist-message');
    const email = form.email.value.trim();

    if (!msgEl) return;

    if (!email || !email.includes('@')) {
      msgEl.textContent = 'Please enter a valid email.';
      msgEl.className = 'waitlist-message error';
      return;
    }

    msgEl.textContent = 'Joining waitlist...';
    msgEl.className = 'waitlist-message';

    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/waitlist`, {
        method: 'POST',
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json',
          Prefer: 'return=representation',
        },
        body: JSON.stringify({ email, source: 'landing' }),
      });

      if (!res.ok) {
        console.error('Waitlist error', await res.text());
        msgEl.textContent = 'Error joining waitlist. Please try again.';
        msgEl.className = 'waitlist-message error';
        return;
      }

      form.reset();
      msgEl.textContent = 'You‚Äôre in. We‚Äôll reach out soon.';
      msgEl.className = 'waitlist-message success';
    } catch (err) {
      console.error(err);
      msgEl.textContent = 'Network error. Please try again.';
      msgEl.className = 'waitlist-message error';
    }
  }

  // === AUTH ===
  async function handleAuthSubmit(e) {
    e.preventDefault();
    const form = e.target;
    const email = form.email.value.trim();
    const password = form.password.value;

    if (!email || !password) {
      setAuthMessage('Email and password are required.', 'error');
      return;
    }

    setAuthMessage('Working...');

    try {
      if (authMode === 'signup') {
        const { error } = await supabase.auth.signUp({ email, password });
        if (error) throw error;
        setAuthMessage(
          'Account created. Check your email, then sign in.',
          'success'
        );
        setAuthMode('signin');
      } else {
        const { error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });
        if (error) throw error;
        setAuthMessage('');
        await onAuthChanged();
      }
    } catch (err) {
      console.error(err);
      setAuthMessage(err.message || 'Auth error.', 'error');
    }
  }

  async function handleSignOut() {
    await supabase.auth.signOut();
    await onAuthChanged();
  }

  async function onAuthChanged() {
    const { data } = await supabase.auth.getSession();
    const session = data.session;

    const authWrapper = document.getElementById('auth-wrapper');
    const appShell = document.querySelector('.app-shell');
    const signoutBtn = document.getElementById('signout-btn');

    if (session) {
      if (authWrapper) authWrapper.style.display = 'none';
      if (appShell) appShell.style.display = 'block';
      if (signoutBtn) signoutBtn.style.display = 'inline-block';

      loadDashboard();
      loadContractors();
      loadPayouts();
    } else {
      if (authWrapper) authWrapper.style.display = 'flex';
      if (appShell) appShell.style.display = 'none';
      if (signoutBtn) signoutBtn.style.display = 'none';
    }
  }

  // === INIT ===
  document.addEventListener('DOMContentLoaded', () => {
    // Footer year
    const yearEl = document.getElementById('year');
    if (yearEl) yearEl.textContent = new Date().getFullYear();

    // Tabs
    initTabs();

    // Forms
    const addContractorForm = document.getElementById('add-contractor-form');
    if (addContractorForm) {
      addContractorForm.addEventListener('submit', addContractor);
    }

    const payoutForm = document.getElementById('payout-form');
    if (payoutForm) {
      payoutForm.addEventListener('submit', addPayout);
    }

    const waitlistForm = document.getElementById('waitlist-form');
    if (waitlistForm) {
      waitlistForm.addEventListener('submit', handleWaitlistSubmit);
    }

    // Dashboard filters
    const rangeSelect = document.getElementById('dash-range');
    const chainSelect = document.getElementById('dash-chain');

    if (rangeSelect) {
      rangeSelect.addEventListener('change', () => {
        filterRange = rangeSelect.value;
        loadDashboard();
        loadPayouts();
      });
    }

    if (chainSelect) {
      chainSelect.addEventListener('change', () => {
        filterChain = chainSelect.value;
        loadDashboard();
        loadPayouts();
      });
    }

    // Auth
    const authForm = document.getElementById('auth-form');
    const toggle = document.getElementById('auth-toggle-mode');
    const signoutBtn = document.getElementById('signout-btn');

    if (authForm) authForm.addEventListener('submit', handleAuthSubmit);
    if (toggle) {
      toggle.addEventListener('click', () =>
        setAuthMode(authMode === 'signin' ? 'signup' : 'signin')
      );
    }
    if (signoutBtn) signoutBtn.addEventListener('click', handleSignOut);

    setAuthMode('signin');
    onAuthChanged();
  });
</script>




  

  
</body>
</html>
