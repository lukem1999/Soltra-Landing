<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soltra ‚Äî Stablecoin Contractor Payouts</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="auth-wrapper">
  <div class="auth-card">
    <h2>Sign in to Soltra</h2>
    <p class="auth-subtitle">Use your email to manage your contractor payouts.</p>

    <form id="auth-form">
      <input type="email" name="email" placeholder="you@company.com" required>
      <input type="password" name="password" placeholder="Password" required>
      <button type="submit" class="btn auth-btn">Sign in</button>
    </form>

    <button id="auth-toggle-mode" class="auth-toggle">
      New here? Create an account
    </button>

    <p id="auth-message" class="auth-message"></p>
    <button id="signout-btn" class="mini-btn" style="display:none;">Sign out</button>

  </div>
</div>

  <header class="navbar">
  <div class="logo">
    <span class="soltra-s">S</span>
  </div>
  <span class="brand-text">Soltra</span>
</header>


  <main>
   <section class="hero">
  <div class="hero-inner">
    <div class="hero-copy">
      <div class="eyebrow">Stablecoin payouts for global teams</div>
      
      <h1>Global stablecoin payouts.<br><span class="highlight">Clean records. No spreadsheets.</span></h1>
      <p>Pay contractors in USDC and keep organized, auditable records built for Web3 teams and DAOs.</p>
      <a class="btn" href="mailto:founder@soltralabs.com">Join the Waitlist</a>
    </div>

    <div class="hero-visual">
      <div class="payout-card">
        <div class="payout-card-header">
          <span>Payouts ‚Äî September</span>
          <span class="payout-badge">USDC ‚Ä¢ Base</span>
        </div>
        <ul class="payout-list">
          <li><span>0xA3‚Ä¶7f9</span><span>1,200 USDC</span></li>
          <li><span>0x93‚Ä¶c21</span><span>850 USDC</span></li>
          <li><span>0x12‚Ä¶ab4</span><span>1,700 USDC</span></li>
        </ul>
        <div class="payout-footer">
          <div>
            <strong>$3,750</strong>
            <small>Total this month</small>
          </div>
          <div>
            <strong>9</strong>
            <small>Contractors</small>
          </div>
          <div>
            <strong>CSV</strong>
            <small>Export ready</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

    <section class="app-shell">
  <div class="app-layout">
    <!-- Sidebar -->
    <aside class="app-sidebar">
      <div class="sidebar-logo">
        <div class="sidebar-mark">S</div>
        <span>Soltra</span>
      </div>

      <nav class="app-tabs">
        <button class="tab-button active" data-target="dashboard">Overview</button>
        <button class="tab-button" data-target="contractors">Contractors</button>
        <button class="tab-button" data-target="payouts">Payouts</button>
        <button class="tab-button" data-target="reports">Reports</button>
      </nav>

      <div class="sidebar-foot">
        <span class="sidebar-label">Environment</span>
        <span class="sidebar-pill">Sandbox</span>
      </div>
    </aside>

    <!-- Main content -->
    <div class="app-main">
      <header class="app-header">
        <div>
          <h2>Soltra Dashboard</h2>
          <p>Track stablecoin payouts, contractors, and reporting in one place.</p>
        </div>
        <div class="app-header-controls">
          <select class="app-select">
            <option>This month</option>
            <option>Last month</option>
            <option>Last 90 days</option>
          </select>
          <div class="user-pill">
            <span class="user-avatar">L</span>
            <span class="user-name">You</span>
          </div>
        </div>
      </header>

      <div class="app-main-inner">
        <!-- ================= DASHBOARD VIEW ================= -->
        <div class="app-view" id="view-dashboard">
          <div class="kpi-row">
            <div class="kpi-card">
              <span class="kpi-label">Total paid this month</span>
              <span class="kpi-value">$3,750</span>
              <span class="kpi-sub">9 payouts ‚Ä¢ USDC on Base</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Active contractors</span>
              <span class="kpi-value">9</span>
              <span class="kpi-sub">Across 4 countries</span>
            </div>
            <div class="kpi-card">
              <span class="kpi-label">Chains used</span>
              <span class="kpi-value">2</span>
              <span class="kpi-sub">Base, Polygon</span>
            </div>
          </div>

          <div class="dashboard-row">
            <div class="card">
              <h3 class="card-title">Recent payouts</h3>
              <table class="app-table">
                <thead>
                  <tr>
                    <th>Contractor</th>
                    <th>Amount</th>
                    <th>Chain</th>
                    <th>Hash</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="dashboard-payouts-body">
                  <tr>
                    <td>Anna L</td>
                    <td>1,200 USDC</td>
                    <td>Base</td>
                    <td>0x9F1C‚Ä¶72a3</td>
                    <td>Sep 12</td>
                  </tr>
                  <tr>
                    <td>Marcus V</td>
                    <td>850 USDC</td>
                    <td>Base</td>
                    <td>0xA8B7‚Ä¶19f0</td>
                    <td>Sep 10</td>
                  </tr>
                  <tr>
                    <td>Sora K</td>
                    <td>1,700 USDC</td>
                    <td>Base</td>
                    <td>0xD233‚Ä¶44b1</td>
                    <td>Sep 08</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="card card-side">
              <h3 class="card-title">This month snapshot</h3>
              <ul class="summary-list">
                <li>
                  <span>Total contractors paid</span>
                  <strong>6</strong>
                </li>
                <li>
                  <span>Average payout size</span>
                  <strong>$625</strong>
                </li>
                <li>
                  <span>CSV exports</span>
                  <strong>2</strong>
                </li>
                <li>
                  <span>Failed payouts</span>
                  <strong>0</strong>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- ================= CONTRACTORS VIEW ================= -->
        <div class="app-view hidden" id="view-contractors">
          <div class="list-header">
            <h3>Contractors</h3>
          </div>

          <!-- Add contractor form -->
          <form class="add-contractor-form" id="add-contractor-form">
            <input type="text" name="name" placeholder="Name" required>
            <input type="text" name="wallet_address" placeholder="Wallet address (0x...)" required>
            <input type="text" name="role" placeholder="Role (e.g. DevOps)">
            <input type="text" name="country" placeholder="Country (e.g. US)">
            <button type="submit" class="mini-btn">+ Add contractor</button>
          </form>

          <table class="app-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Wallet</th>
                <th>Role</th>
                <th>Country</th>
                <th>Last paid</th>
              </tr>
            </thead>
            <tbody id="contractors-body">
              <!-- Filled dynamically from Supabase -->
            </tbody>
          </table>
        </div>

        <!-- ================= PAYOUTS VIEW ================= -->
        <div class="app-view hidden" id="view-payouts">
          <h3>Log new payout</h3>

          <form class="payout-form" id="payout-form">
            <label>
              Contractor
              <select name="contractor_id" id="payout-contractor" required>
                <option value="">Select contractor</option>
                <!-- options filled from contractors table -->
              </select>
            </label>

            <label>
              Amount (USDC)
              <input type="number" name="amount" step="0.01" placeholder="1200" required>
            </label>

            <label>
              Chain
              <select name="chain" required>
                <option value="base">Base</option>
                <option value="polygon">Polygon</option>
              </select>
            </label>

            <label>
              Transaction hash
              <input type="text" name="tx_hash" placeholder="0x..." required>
            </label>

            <label>
              Date
              <input type="date" name="tx_date">
            </label>

            <label>
              Notes (optional)
              <textarea name="note" rows="2" placeholder="Weekly contributor payout"></textarea>
            </label>

            <button type="submit" class="btn full-width">Save payout</button>
          </form>

          <h3 class="table-title">Recent payouts</h3>
          <table class="app-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Contractor</th>
                <th>Amount</th>
                <th>Chain</th>
                <th>Hash</th>
              </tr>
            </thead>
            <tbody id="payouts-body">
              <!-- filled dynamically -->
            </tbody>
          </table>
        </div>

        <!-- ================= REPORTS VIEW ================= -->
        <div class="app-view hidden" id="view-reports">
          <div class="list-header">
            <h3>Reports</h3>
            <button class="mini-btn">Export CSV</button>
          </div>

          <div class="filters-row">
            <select>
              <option>September 2025</option>
              <option>August 2025</option>
            </select>
            <select>
              <option>All contractors</option>
              <option>Anna L</option>
              <option>Marcus V</option>
            </select>
            <select>
              <option>All chains</option>
              <option>Base</option>
              <option>Polygon</option>
            </select>
          </div>

          <table class="app-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Contractor</th>
                <th>Amount</th>
                <th>USD value</th>
                <th>Hash</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Sep 12</td>
                <td>Anna L</td>
                <td>1,200 USDC</td>
                <td>$1,200</td>
                <td>0x9F1C‚Ä¶72a3</td>
              </tr>
              <tr>
                <td>Sep 10</td>
                <td>Marcus V</td>
                <td>850 USDC</td>
                <td>$850</td>
                <td>0xA8B7‚Ä¶19f0</td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>
</section>

    




    <section class="features">
      <div class="feature">
        <h3>üí∏ Payout Logs</h3>
        <p>Track USDC transactions with TX hashes and timestamps.</p>
      </div>
      <div class="feature">
        <h3>üìä Reports</h3>
        <p>Instant CSV/PDF exports for accountants or audits.</p>
      </div>
      <div class="feature">
        <h3>üîê Non-Custodial</h3>
        <p>We never touch funds ‚Äî Soltra keeps your records clean, not your money.</p>
      </div>
    </section>
  </main>

  <footer>
    <p>¬© <span id="year"></span> Soltra Labs Inc ¬∑ Built for the future of finance</p>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>

  <script>
  const tabButtons = document.querySelectorAll('.tab-button');
  const views = {
    dashboard: document.getElementById('view-dashboard'),
    contractors: document.getElementById('view-contractors'),
    payouts: document.getElementById('view-payouts'),
    reports: document.getElementById('view-reports'),
  };

  tabButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      // Update active tab
      tabButtons.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');

      // Show correct view
      const target = btn.dataset.target;
      Object.entries(views).forEach(([key, el]) => {
        if (key === target) {
          el.classList.remove('hidden');
        } else {
          el.classList.add('hidden');
        }
      });
    });
  });
</script>

<script>
  // === Supabase config (DEV ONLY) ===
  const SUPABASE_URL = 'https://lvuvkgnkhrzpwlssupyh.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx2dXZrZ25raHJ6cHdsc3N1cHloIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNDkyOTIsImV4cCI6MjA3ODkyNTI5Mn0.9C1-3Di7tXJCgb_7ZHj7mz6QL5fDMvnvmBziYqgGeDs';

  let contractorsCache = [];

  // ---- Contractors ----
  async function loadContractors() {
    const tbody = document.getElementById('contractors-body');
    if (tbody) {
      tbody.innerHTML = '<tr><td colspan="5">Loading contractors...</td></tr>';
    }

    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/contractors?select=*`, {
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`
        }
      });

      if (!res.ok) {
        if (tbody) {
          tbody.innerHTML = `<tr><td colspan="5">Error loading data (${res.status})</td></tr>`;
        }
        return;
      }

      const data = await res.json();
      contractorsCache = data; // cache for payouts

      // Fill contractors table
      if (tbody) {
        if (!data.length) {
          tbody.innerHTML = '<tr><td colspan="5">No contractors yet.</td></tr>';
        } else {
          tbody.innerHTML = '';
          data.forEach(c => {
            const tr = document.createElement('tr');
            const lastPaid = c.last_paid_at
              ? new Date(c.last_paid_at).toLocaleDateString()
              : '‚Äî';
            tr.innerHTML = `
              <td>${c.name || ''}</td>
              <td>${c.wallet_address || ''}</td>
              <td>${c.role || ''}</td>
              <td>${c.country || ''}</td>
              <td>${lastPaid}</td>
            `;
            tbody.appendChild(tr);
          });
        }
      }

      populateContractorSelect();
    } catch (err) {
      console.error(err);
      if (tbody) {
        tbody.innerHTML = '<tr><td colspan="5">Error loading contractors.</td></tr>';
      }
    }
  }

  function populateContractorSelect() {
    const select = document.getElementById('payout-contractor');
    if (!select) return;

    // keep first "Select contractor" option
    select.innerHTML = '<option value="">Select contractor</option>';

    contractorsCache.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c.id; // uuid
      opt.textContent = c.name || c.wallet_address;
      select.appendChild(opt);
    });
  }

  async function addContractor(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    const name = formData.get('name')?.trim();
    const wallet = formData.get('wallet_address')?.trim();
    const role = formData.get('role')?.trim();
    const country = formData.get('country')?.trim();

    if (!name || !wallet) {
      alert('Name and wallet address are required.');
      return;
    }

    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/contractors`, {
        method: 'POST',
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json',
          Prefer: 'return=representation'
        },
        body: JSON.stringify({ name, wallet_address: wallet, role, country })
      });

      if (!res.ok) {
        console.error('Error inserting contractor', await res.text());
        alert('Error adding contractor.');
        return;
      }

      form.reset();
      await loadContractors(); // refresh + repopulate select
    } catch (err) {
      console.error(err);
      alert('Network error adding contractor.');
    }
  }

  // ---- Payouts ----
  async function loadPayouts() {
    const tbody = document.getElementById('payouts-body');
    if (!tbody) return;

    tbody.innerHTML = '<tr><td colspan="5">Loading payouts...</td></tr>';

    try {
      // Use PostgREST embedding to get contractor name
      const url = `${SUPABASE_URL}/rest/v1/payouts?select=*,contractors(name)&order=tx_timestamp.desc&limit=15`;
      const res = await fetch(url, {
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`
        }
      });

      if (!res.ok) {
        tbody.innerHTML = `<tr><td colspan="5">Error loading payouts (${res.status})</td></tr>`;
        return;
      }

      const data = await res.json();

      if (!data.length) {
        tbody.innerHTML = '<tr><td colspan="5">No payouts yet.</td></tr>';
        return;
      }

      tbody.innerHTML = '';
      data.forEach(p => {
        const tr = document.createElement('tr');

        const date = p.tx_timestamp
          ? new Date(p.tx_timestamp).toLocaleDateString()
          : '‚Äî';

        const name = p.contractors?.name || 'Unknown';

        tr.innerHTML = `
          <td>${date}</td>
          <td>${name}</td>
          <td>${p.amount} ${p.asset_symbol || 'USDC'}</td>
          <td>${p.chain}</td>
          <td>${p.tx_hash}</td>
        `;
        tbody.appendChild(tr);
      });
    } catch (err) {
      console.error(err);
      tbody.innerHTML = '<tr><td colspan="5">Error loading payouts.</td></tr>';
    }
  }

  async function addPayout(event) {
    event.preventDefault();

    const form = event.target;
    const formData = new FormData(form);

    const contractor_id = formData.get('contractor_id');
    const amountStr = formData.get('amount');
    const chain = formData.get('chain');
    const tx_hash = formData.get('tx_hash')?.trim();
    const tx_date = formData.get('tx_date');
    const note = formData.get('note')?.trim();

    if (!contractor_id || !amountStr || !chain || !tx_hash) {
      alert('Contractor, amount, chain, and tx hash are required.');
      return;
    }

    const amount = Number(amountStr);
    if (!amount || amount <= 0) {
      alert('Amount must be a positive number.');
      return;
    }

    const tx_timestamp = tx_date
      ? new Date(tx_date).toISOString()
      : new Date().toISOString();

    try {
      const res = await fetch(`${SUPABASE_URL}/rest/v1/payouts`, {
        method: 'POST',
        headers: {
          apikey: SUPABASE_ANON_KEY,
          Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
          'Content-Type': 'application/json',
          Prefer: 'return=representation'
        },
        body: JSON.stringify({
          contractor_id,
          amount,
          asset_symbol: 'USDC',
          chain,
          tx_hash,
          tx_timestamp,
          note
        })
      });

      if (!res.ok) {
        console.error('Error inserting payout', await res.text());
        alert('Error saving payout.');
        return;
      }

      form.reset();
      await loadPayouts();
    } catch (err) {
      console.error(err);
      alert('Network error saving payout.');
    }
  }

  // ---- Init ----
  document.addEventListener('DOMContentLoaded', () => {
    loadContractors();
    loadPayouts();

    const addContractorForm = document.getElementById('add-contractor-form');
    if (addContractorForm) {
      addContractorForm.addEventListener('submit', addContractor);
    }

    const payoutForm = document.getElementById('payout-form');
    if (payoutForm) {
      payoutForm.addEventListener('submit', addPayout);
    }
  });
</script>

<!-- Supabase JS client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
</script>

<script>
  // "signin" or "signup"
  let authMode = 'signin';

  function setAuthMessage(text, type = '') {
    const el = document.getElementById('auth-message');
    if (!el) return;
    el.textContent = text || '';
    el.className = 'auth-message';
    if (type) el.classList.add(type);
  }

  function setAuthMode(mode) {
    authMode = mode;
    const toggle = document.getElementById('auth-toggle-mode');
    const btn = document.querySelector('#auth-form .auth-btn');
    if (!toggle || !btn) return;

    if (mode === 'signin') {
      btn.textContent = 'Sign in';
      toggle.textContent = 'New here? Create an account';
    } else {
      btn.textContent = 'Create account';
      toggle.textContent = 'Already have an account? Sign in';
    }
    setAuthMessage('');
  }

  async function handleAuthSubmit(e) {
    e.preventDefault();
    const form = e.target;
    const email = form.email.value.trim();
    const password = form.password.value;

    if (!email || !password) {
      setAuthMessage('Email and password are required.', 'error');
      return;
    }

    setAuthMessage('Working...');

    try {
      if (authMode === 'signup') {
        const { error } = await supabase.auth.signUp({ email, password });
        if (error) throw error;
        setAuthMessage('Account created. You can now sign in.', 'success');
        setAuthMode('signin');
      } else {
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error;
        setAuthMessage('');
        await onAuthChanged();
      }
    } catch (err) {
      console.error(err);
      setAuthMessage(err.message || 'Auth error.', 'error');
    }
  }

  async function handleSignOut() {
    await supabase.auth.signOut();
    await onAuthChanged();
  }

  async function onAuthChanged() {
    const { data } = await supabase.auth.getSession();
    const session = data.session;

    const authWrapper = document.getElementById('auth-wrapper');
    const appShell = document.querySelector('.app-shell');
    const signoutBtn = document.getElementById('signout-btn');

    if (session) {
      if (authWrapper) authWrapper.style.display = 'none';
      if (appShell) appShell.style.display = 'block';
      if (signoutBtn) signoutBtn.style.display = 'inline-block';

      // later: loadContractors(); loadPayouts();
    } else {
      if (authWrapper) authWrapper.style.display = 'flex';
      if (appShell) appShell.style.display = 'none';
      if (signoutBtn) signoutBtn.style.display = 'none';
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    const authForm = document.getElementById('auth-form');
    const toggle = document.getElementById('auth-toggle-mode');
    const signoutBtn = document.getElementById('signout-btn');

    if (authForm) authForm.addEventListener('submit', handleAuthSubmit);
    if (toggle) toggle.addEventListener('click', () =>
      setAuthMode(authMode === 'signin' ? 'signup' : 'signin')
    );
    if (signoutBtn) signoutBtn.addEventListener('click', handleSignOut);

    setAuthMode('signin');
    onAuthChanged();
  });
</script>

  
</body>
</html>
